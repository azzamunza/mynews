<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News Portal</title>
    <link rel="stylesheet" href="./css/article-magazine.css">
    <link id="themeStylesheet" rel="stylesheet" href="./css/newsStyles/darkstyle.css">
    <!-- Custom layout overrides that do not interfere with theme variables -->
    <link rel="stylesheet" href="./css/custom-layout.css">
</head>
<body>
<header>
    <div class="header-container">
        <div class="hamburger" id="hamburgerMenu"><span></span><span></span><span></span></div>
        <h1 class="site-title">NewsHub</h1>

        <!-- Style Selector Dropdown moved into header container and placed to the left of reload -->
        <div class="style-selector-container header-inline">
            <label for="styleSelector" class="style-selector-label">Theme:</label>
            <select id="styleSelector" class="style-selector">
                <option value="">Loading styles...</option>
            </select>
        </div>

        <!-- Reload data button: placed here so it's visible in the header menu -->
        <div class="header-login">
            <div id="user-info" class="header-user-info"></div>

            <button id="reloadDataBtn" class="btn btn-secondary" title="Reload news data" style="display:inline-flex; align-items:center;">
                ⟳ Reload
            </button>

            <div id="g_id_onload"
                 data-client_id="752307788655-djf0dae2j8h10q040g1ombshla687l0j.apps.googleusercontent.com"
                 data-login_uri="https://azzamunza.github.io/mynews/oauth2callback.html"
                 data-auto_prompt="false"
                 data-callback="handleCredentialResponse">
            </div>
            <div class="g_id_signin" data-type="standard"></div>
        </div>
    </div>

    <!-- Desktop Navigation (sticky so it remains once header scrolls away) -->
    <nav id="desktopNav">
        <div class="nav-container">
            <ul class="category-menu" id="categoryMenu">
                <li class="loading">Loading categories...</li>
            </ul>
        </div>
    </nav>
</header>

    <!-- Mobile Menu -->
    <div class="mobile-menu-overlay" id="mobileMenu">
        <div class="mobile-menu-header">
            <h2 style="color: var(--accent-color);">Menu</h2>
            <span class="mobile-menu-close" id="closeMobileMenu">&times;</span>
        </div>
        <ul class="mobile-menu-items" id="mobileMenuItems">
            <li class="loading">Loading...</li>
        </ul>
    </div>

    <div class="main-layout">
        <div class="content-area">
            <!-- Hero Carousel -->
            <section class="hero-section" id="heroSection" style="display: none;">
                <div class="carousel-container">
                    <div class="carousel-slides" id="carouselSlides"></div>
                    <div class="carousel-nav">
                        <button class="carousel-btn" id="carouselPrev">‹</button>
                        <button class="carousel-btn" id="carouselNext">›</button>
                    </div>
                    <div class="carousel-dots" id="carouselDots"></div>
                </div>
            </section>

            <!-- Article Grid -->
            <div class="article-grid" id="articleGrid">
                <div class="loading">
                    <div class="spinner"></div>
                    Loading articles...
                </div>
            </div>
        </div>

        <!-- Headlines Sidebar -->
        <aside class="headlines-sidebar">
            <h2 class="headlines-title">Headlines</h2>
            <div id="headlinesList">
                <div class="loading">Loading...</div>
            </div>
        </aside>
    </div>

    <!-- Article Modal -->
    <div class="modal" id="articleModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">&times;</button>
            <div id="modalContentArea"></div>
        </div>
    </div>

   <script>
    let isLoggedIn = false;
    let loggedInUserEmail = '';
    let articlesData = [], categoriesData = [], trendingData = [], videosData = [];
    let currentFilter = 'all', currentCarouselIndex = 0;
    let carouselInterval, makeWebhook = '', authToken = '';
    
        document.addEventListener('DOMContentLoaded', function() {
            loadAvailableStyles();
            loadNewsData();
            setupEventListeners();
            // header scroll handling to allow header-container to scroll away while desktopNav remains sticky
            document.addEventListener('scroll', handleHeaderScroll, { passive: true });
        });
    
        function handleHeaderScroll() {
            const header = document.querySelector('header');
            const headerContainer = document.querySelector('.header-container');
            const desktopNav = document.getElementById('desktopNav');

            // Leave header in normal flow; the desktopNav is sticky via CSS so it will remain once it reaches top
            // Slight class toggles for visual effects when header is scrolled past
            const rect = headerContainer.getBoundingClientRect();
            if (rect.bottom <= 0) {
                // header-container fully scrolled out
                header.classList.add('header-hidden');
            } else {
                header.classList.remove('header-hidden');
            }
        }
    
        // Load available styles dynamically from JSON
        async function loadAvailableStyles() {
            const styleSelector = document.getElementById('styleSelector');
            const stylesPath = './css/newsStyles/';
            const stylesJsonPath = './css/styles.json';
            
            try {
                // Fetch the styles configuration
                const response = await fetch(stylesJsonPath);
                
                if (!response.ok) {
                    throw new Error(`Failed to load styles.json: ${response.status}`);
                }
                
                const stylesConfig = await response.json();
                
                styleSelector.innerHTML = '';
                
                // Populate dropdown with styles from JSON
                stylesConfig.styles.forEach(style => {
                    const option = document.createElement('option');
                    option.value = stylesPath + style.file;
                    option.textContent = style.name;
                    option.setAttribute('data-description', style.description);
                    styleSelector.appendChild(option);
                });
                
                // Load saved preference or default style
                const savedStyle = localStorage.getItem('selectedStyle') || stylesPath + stylesConfig.default;
                styleSelector.value = savedStyle;
                loadStyle(savedStyle);
                
                // Add change event listener
                styleSelector.addEventListener('change', function() {
                    const selectedStyle = this.value;
                    loadStyle(selectedStyle);
                    localStorage.setItem('selectedStyle', selectedStyle);
                });
                
            } catch (error) {
                console.error('Error loading styles configuration:', error);
                
                // Fallback to hardcoded styles if JSON fails
                styleSelector.innerHTML = '<option value="./css/newsStyles/darkstyle.css">Dark Style</option>';
                const fallbackStyle = './css/newsStyles/darkstyle.css';
                styleSelector.value = fallbackStyle;
                loadStyle(fallbackStyle);
            }
        }
    
        function loadStyle(styleUrl) {
            const themeLink = document.getElementById('themeStylesheet');
            themeLink.href = styleUrl;
        }
    
        // Expose handleCredentialResponse globally so Google can call it
        function handleCredentialResponse(response) {
        const user = jwt_decode(response.credential);
        const userInfoDiv = document.getElementById('user-info');
        userInfoDiv.textContent = user.name;
    
        isLoggedIn = true;
        loggedInUserEmail = user.email;
    
        if (user.email === 'azzamunza@gmail.com') {
            const jobButtons = document.querySelectorAll('.btn-job');
            jobButtons.forEach(btn => btn.style.display = 'inline-block');
        }
    }
    function openModal(articleId) {
        const article = articlesData.find(a => a.id === articleId);
        if (!article) return;
    
        const modal = document.getElementById('articleModal');
        const modalContent = document.getElementById('modalContentArea');
    
        let badges = '';
        if (article.isTrending) badges += '<span class="badge badge-trending">🔥 Trending</span>';
        if (article.isJob) badges += '<span class="badge badge-job">💼 Job Listing</span>';
        if (article.isVideo) badges += '<span class="badge badge-video">▶ Video Content</span>';
    
        let videoEmbed = '';
        if (article.isVideo && article.videoUrl) {
            const videoId = extractYouTubeId(article.videoUrl);
            if (videoId) {
                videoEmbed = `<div class="video-player-container">
                    <iframe src="https://www.youtube.com/embed/${videoId}?rel=0" allowfullscreen
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture">
                    </iframe>
                </div>`;
            }
        }
    
        let jobButton = '';
        if (article.isJob && makeWebhook && authToken && isLoggedIn && loggedInUserEmail === 'azzamunza@gmail.com') {
            jobButton = `<button class="btn btn-job" onclick="submitJobApplication(
                '${article.id}',
                '${escapeHtml(article.sourceUrl)}',
                '${escapeHtml(article.title)}'
            )">💼 Create Job Application</button>`;
        }
    
        const shareButtons = `
            <button class="btn btn-secondary" onclick="shareArticle('twitter','${escapeHtml(article.title)}','${escapeHtml(article.sourceUrl)}')">Share on Twitter</button>
            <button class="btn btn-secondary" onclick="shareArticle('linkedin','${escapeHtml(article.title)}','${escapeHtml(article.sourceUrl)}')">Share on LinkedIn</button>
            <button class="btn btn-secondary" onclick="copyToClipboard('${escapeHtml(article.sourceUrl)}')">📋 Copy Link</button>
        `;
    
        modalContent.innerHTML = `
            <img src="${article.bannerImage}" alt="${article.title}" class="modal-banner" loading="lazy">
            <div class="modal-body">
                <div class="modal-header-section">
                    <div class="modal-badges">${badges}</div>
                    <h1 class="modal-title">${article.title}</h1>
                    <div class="modal-meta">
                        <span>By ${article.author}</span>
                        <span>${article.date || article.publishDate}</span>
                        <span>${article.readTime} min read</span>
                    </div>
                    <div class="modal-actions">
                        <a href="${article.sourceUrl}" target="_blank" rel="noopener noreferrer" class="btn btn-primary">📰 Read Original Source</a>
                        ${jobButton}
                        ${shareButtons}
                    </div>
                </div>
                ${videoEmbed}
                <div class="modal-article-content">
                    ${article.fullContent}
                </div>
            </div>
        `;
    (function adjustModalWidth() {
      // make the modal match the content-area width
      const contentArea = document.querySelector('.content-area');
      const modalBox = document.querySelector('.modal .modal-content');
      if (contentArea && modalBox) {
        modalBox.style.maxWidth = Math.min(contentArea.clientWidth, window.innerWidth * 0.95) + 'px';
      }
    
      // keep modal width in sync if user resizes the window while modal is open
      function onResize() {
        if (!modalBox) return;
        modalBox.style.maxWidth = Math.min(contentArea.clientWidth, window.innerWidth * 0.95) + 'px';
      }
    
      // attach a one-time resize handler while modal is open
      const resizeHandler = () => onResize();
      window.addEventListener('resize', resizeHandler);
    
      // remove the listener when modal closes
      const observer = new MutationObserver((mutations) => {
        for (const m of mutations) {
          if (m.type === 'attributes' && m.attributeName === 'class') {
            const modal = document.querySelector('.modal');
            if (modal && !modal.classList.contains('active')) {
              window.removeEventListener('resize', resizeHandler);
              observer.disconnect();
            }
          }
        }
      });
      const modalEl = document.querySelector('.modal');
      if (modalEl) observer.observe(modalEl, { attributes: true });
    })();
        modal.classList.add('active');
    }
        function setupEventListeners() {
            document.getElementById('hamburgerMenu').addEventListener('click', toggleMobileMenu);
            document.getElementById('closeMobileMenu').addEventListener('click', toggleMobileMenu);
            document.getElementById('carouselPrev').addEventListener('click', () => changeSlide(-1));
            document.getElementById('carouselNext').addEventListener('click', () => changeSlide(1));
            
            document.getElementById('articleModal').addEventListener('click', function(e) {
                if (e.target === this) closeModal();
            });
            
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') closeModal();
            });
        }
    
        async function loadNewsData() {
            try {
                // Fetch the external JSON file
                const response = await fetch('news-data.json');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                categoriesData = data.categories || [];
                articlesData = data.articles || [];
                trendingData = data.trending || [];
                videosData = data.videos || [];
                makeWebhook = data.makeWebhook || '';
                authToken = data.authToken || '';
                
                renderCategories();
                renderCarousel();
                renderArticles();
                renderHeadlines();
                
            } catch (error) {
                console.error('Error loading news data:', error);
                showError(error.message);
            }
        }
    
        function showError(message) {
            document.getElementById('categoryMenu').innerHTML = 
                `<li style="color: var(--accent-color);">Error loading data: ${message}</li>`;
            document.getElementById('articleGrid').innerHTML = 
                `<div class="loading" style="color: var(--accent-color);">
                    <p>Error loading articles: ${message}</p>
                    <p style="font-size: 0.9rem; margin-top: 1rem;">Make sure news-data.json is in the same directory as this HTML file.</p>
                </div>`;
        }
    
        function renderCategories() {
            const desktopMenu = document.getElementById('categoryMenu');
            const mobileMenu = document.getElementById('mobileMenuItems');
            
            desktopMenu.innerHTML = '';
            mobileMenu.innerHTML = '';
            
            categoriesData.forEach(category => {
                // Desktop menu
                const li = document.createElement('li');
                li.className = 'category-item';
                const link = document.createElement('a');
                link.className = 'category-link' + (category.active ? ' active' : '');
                link.textContent = category.name;
                link.onclick = (e) => {
                    e.preventDefault();
                    filterByCategory(category.id);
                };
                li.appendChild(link);
                desktopMenu.appendChild(li);
                
                // Mobile menu
                const mli = document.createElement('li');
                mli.className = 'mobile-menu-item';
                const mlink = document.createElement('a');
                mlink.className = 'mobile-menu-link' + (category.active ? ' active' : '');
                mlink.textContent = category.name;
                mlink.onclick = (e) => {
                    e.preventDefault();
                    filterByCategory(category.id);
                    toggleMobileMenu();
                };
                mli.appendChild(mlink);
                mobileMenu.appendChild(mli);
            });
        }
    
        function renderCarousel() {
            const trendingArticles = articlesData.filter(a => a.isTrending);
            
            if (trendingArticles.length === 0 || currentFilter !== 'all') {
                document.getElementById('heroSection').style.display = 'none';
                return;
            }
            
            document.getElementById('heroSection').style.display = 'block';
            const slidesContainer = document.getElementById('carouselSlides');
            const dotsContainer = document.getElementById('carouselDots');
            
            slidesContainer.innerHTML = '';
            dotsContainer.innerHTML = '';
            
            // Create slides that contain up to 2 small article cards each (so carousel will show 2 cards per slide)
            for (let i = 0; i < trendingArticles.length; i += 2) {
                const pair = trendingArticles.slice(i, i + 2);
                const slide = document.createElement('div');
                slide.className = 'carousel-slide' + (i === 0 ? ' active' : '');

                const cardsHtml = pair.map(article => `
                    <div class="carousel-card" onclick="openModal('${article.id}')">
                        <img src="${article.bannerImage}" alt="${article.title}" loading="lazy">
                        <div class="carousel-card-content">
                            <h4>${article.title}</h4>
                        </div>
                    </div>
                `).join('');

                slide.innerHTML = `<div class="carousel-pair">${cardsHtml}</div>`;
                slidesContainer.appendChild(slide);

                const dot = document.createElement('div');
                dot.className = 'carousel-dot' + (i === 0 ? ' active' : '');
                const dotIndex = i / 2;
                dot.onclick = () => goToSlide(dotIndex);
                dotsContainer.appendChild(dot);
            }
            
            if (trendingArticles.length > 2) {
                startCarousel();
            }
        }
    
        function changeSlide(direction) {
            const slides = document.querySelectorAll('.carousel-slide');
            const dots = document.querySelectorAll('.carousel-dot');
            
            slides[currentCarouselIndex].classList.remove('active');
            dots[currentCarouselIndex].classList.remove('active');
            
            currentCarouselIndex = (currentCarouselIndex + direction + slides.length) % slides.length;
            
            slides[currentCarouselIndex].classList.add('active');
            dots[currentCarouselIndex].classList.add('active');
            
            resetCarousel();
        }
    
        function goToSlide(index) {
            const slides = document.querySelectorAll('.carousel-slide');
            const dots = document.querySelectorAll('.carousel-dot');
            
            slides[currentCarouselIndex].classList.remove('active');
            dots[currentCarouselIndex].classList.remove('active');
            
            currentCarouselIndex = index;
            
            slides[currentCarouselIndex].classList.add('active');
            dots[currentCarouselIndex].classList.add('active');
            
            resetCarousel();
        }
    
        function startCarousel() {
            clearInterval(carouselInterval);
            carouselInterval = setInterval(() => {
                changeSlide(1);
            }, 5000);
        }
    
        function resetCarousel() {
            clearInterval(carouselInterval);
            startCarousel();
        }
    
        function renderArticles(filterCategory = 'all') {
            const gridContainer = document.getElementById('articleGrid');
            gridContainer.innerHTML = '';
            
            const filteredArticles = filterCategory === 'all' 
                ? articlesData 
                : articlesData.filter(article => article.category === filterCategory);
            
            if (filteredArticles.length === 0) {
                gridContainer.innerHTML = '<div class="loading">No articles found in this category.</div>';
                return;
            }
            
            // First Row: custom 3-column layout (left AI, middle wide slideshow article, right GAME NEWS)
            const firstRow = document.createElement('div');
            firstRow.className = 'grid-first-row';

            // LEFT column: AI TECHNOLOGY
            const leftCol = document.createElement('div');
            leftCol.className = 'col-left';
            leftCol.innerHTML = `<h3 class="section-title">AI TECHNOLOGY</h3>`;
            const aiArticles = filteredArticles.filter(a => a.category === 'ai-technology-and-news').slice(0, 6);
            if (aiArticles.length > 0) {
                const firstAI = aiArticles[0];
                const firstAIHtml = `
                    <div class="ai-main">
                        <img src="${firstAI.bannerImage}" alt="${firstAI.title}" loading="lazy">
                        <h4 class="ai-main-title">${firstAI.title}</h4>
                        <hr>
                    </div>
                `;
                leftCol.insertAdjacentHTML('beforeend', firstAIHtml);

                const list = document.createElement('div');
                list.className = 'ai-list';
                aiArticles.slice(1).forEach(a => {
                    const item = document.createElement('div');
                    item.className = 'ai-list-item';
                    item.innerHTML = `<div class="ai-title-only">${a.title}</div><hr />`;
                    item.onclick = () => openModal(a.id);
                    list.appendChild(item);
                });
                leftCol.appendChild(list);
            } else {
                leftCol.innerHTML += '<div class="ai-empty">No AI Technology articles found.</div>';
            }

            // MIDDLE column: wider article card with slideshow if multiple images
            const middleCol = document.createElement('div');
            middleCol.className = 'col-middle';

            const mainArticle = filteredArticles[0];
            if (mainArticle) {
                const images = mainArticle.images && mainArticle.images.length ? mainArticle.images : [mainArticle.bannerImage || mainArticle.thumbnailImage];
                const slideshowId = `slideshow-${mainArticle.id}`;
                let slidesHtml = images.map((src, idx) => `
                    <div class="middle-slide${idx === 0 ? ' active' : ''}"><img src="${src}" alt="${mainArticle.title}" loading="lazy"></div>
                `).join('');

                middleCol.innerHTML = `
                    <div class="middle-main-article">
                        <div class="middle-slideshow" id="${slideshowId}">
                            ${slidesHtml}
                            <div class="middle-slideshow-nav">
                                <button class="ms-prev">‹</button>
                                <button class="ms-next">›</button>
                            </div>
                        </div>
                        <h2 class="middle-title">${mainArticle.title}</h2>
                        <p class="middle-excerpt">${mainArticle.excerpt || ''}</p>
                    </div>
                `;

                // small horizontal cards under if space
                const smallList = document.createElement('div');
                smallList.className = 'middle-small-list';
                const smallArticles = filteredArticles.slice(1, 5);
                smallArticles.forEach(a => {
                    const item = document.createElement('div');
                    item.className = 'middle-small-item';
                    item.innerHTML = `
                        <img src="${a.thumbnailImage}" alt="${a.title}" loading="lazy">
                        <div class="middle-small-title">${a.title}</div>
                    `;
                    item.onclick = () => openModal(a.id);
                    smallList.appendChild(item);
                });
                middleCol.appendChild(smallList);

                // add slideshow controls behavior
                setTimeout(() => initMiddleSlideshow(slideshowId), 40);
            }

            // RIGHT column: GAME NEWS
            const rightCol = document.createElement('div');
            rightCol.className = 'col-right';
            rightCol.innerHTML = `<h3 class="section-title">GAME NEWS</h3>`;
            const gameArticles = filteredArticles.filter(a => a.subCategory === 'games' || a.category === 'entertainment').slice(0, 6);
            if (gameArticles.length > 0) {
                gameArticles.forEach(a => {
                    const item = document.createElement('div');
                    item.className = 'game-item';
                    item.innerHTML = `
                        <img src="${a.thumbnailImage}" alt="${a.title}" loading="lazy">
                        <div class="game-title">${a.title}</div>
                    `;
                    item.onclick = () => openModal(a.id);
                    rightCol.appendChild(item);
                });
            } else {
                rightCol.innerHTML += '<div class="game-empty">No Game News found.</div>';
            }

            firstRow.appendChild(leftCol);
            firstRow.appendChild(middleCol);
            firstRow.appendChild(rightCol);

            gridContainer.appendChild(firstRow);

            // ANIME Section (below first row)
            const animeSection = document.createElement('section');
            animeSection.className = 'anime-section';
            animeSection.innerHTML = '<h3 class="section-title">ANIME</h3>';
            const animeGrid = document.createElement('div');
            animeGrid.className = 'anime-grid';

            const animeArticles = filteredArticles.filter(a => a.category === 'anime').slice(0, 3);
            if (animeArticles.length > 0) {
                const leftMain = document.createElement('div');
                leftMain.className = 'anime-left';
                const main = animeArticles[0];
                leftMain.innerHTML = `
                    <div class="anime-main-card" onclick="openModal('${main.id}')">
                        <img src="${main.bannerImage || main.thumbnailImage}" alt="${main.title}" loading="lazy">
                        <div class="anime-overlay"><h4>${main.title}</h4></div>
                    </div>
                `;
                animeGrid.appendChild(leftMain);

                const rightColAnime = document.createElement('div');
                rightColAnime.className = 'anime-right';
                const stacked = animeArticles.slice(1,3);
                stacked.forEach(a => {
                    const c = document.createElement('div');
                    c.className = 'anime-small-card';
                    c.innerHTML = `
                        <img src="${a.thumbnailImage}" alt="${a.title}" loading="lazy">
                        <div class="anime-small-title">${a.title}</div>
                    `;
                    c.onclick = () => openModal(a.id);
                    rightColAnime.appendChild(c);
                });
                animeGrid.appendChild(rightColAnime);
            } else {
                animeGrid.innerHTML = '<div class="anime-empty">No Anime articles found.</div>';
            }

            animeSection.appendChild(animeGrid);
            gridContainer.appendChild(animeSection);

            // Remaining articles in 3-equal columns
            const remaining = filteredArticles.slice(5);
            if (remaining.length > 0) {
                const restGrid = document.createElement('div');
                restGrid.className = 'rest-grid';
                remaining.forEach(article => {
                    const card = document.createElement('div');
                    card.className = 'article-card';

                    let badges = '';
                    if (article.isTrending) badges += '<span class="badge badge-trending">🔥 Trending</span>';
                    if (article.isJob) badges += '<span class="badge badge-job">💼 Job</span>';
                    if (article.isVideo) badges += '<span class="badge badge-video">▶ Video</span>';

                    const imageHtml = article.isVideo 
                        ? `<div class="video-thumbnail">
                             <img src="${article.thumbnailImage}" alt="${article.title}" class="article-image" loading="lazy">
                             <div class="video-play-icon">▶</div>
                           </div>`
                        : `<img src="${article.thumbnailImage}" alt="${article.title}" class="article-image" loading="lazy">`;

                    card.innerHTML = `
                        <div class="article-image-container">
                            ${imageHtml}
                            <div class="article-badges">${badges}</div>
                        </div>
                        <div class="article-content">
                            <span class="article-category">${article.category}</span>
                            <h2 class="article-title">${article.title}</h2>
                            <p class="article-excerpt">${article.excerpt}</p>
                            <div class="article-meta">
                                <span>${article.author}</span>
                                <span>${article.date || article.publishDate}</span>
                            </div>
                        </div>
                    `;

                    card.onclick = () => openModal(article.id);
                    restGrid.appendChild(card);
                });
                gridContainer.appendChild(restGrid);
            }
        }
    
        function initMiddleSlideshow(id) {
            const container = document.getElementById(id);
            if (!container) return;
            const slides = container.querySelectorAll('.middle-slide');
            let idx = 0;
            container.querySelector('.ms-prev').addEventListener('click', () => {
                slides[idx].classList.remove('active');
                idx = (idx - 1 + slides.length) % slides.length;
                slides[idx].classList.add('active');
            });
            container.querySelector('.ms-next').addEventListener('click', () => {
                slides[idx].classList.remove('active');
                idx = (idx + 1) % slides.length;
                slides[idx].classList.add('active');
            });
        }
    
        function renderHeadlines() {
            const headlinesList = document.getElementById('headlinesList');
            headlinesList.innerHTML = '';
            
            const recentArticles = articlesData.slice(0, 10);
            
            recentArticles.forEach(article => {
                const headline = document.createElement('div');
                headline.className = 'headline-item';
                headline.innerHTML = `
                    <div class="headline-category">${article.category}</div>
                    <div class="headline-title">${article.title}</div>
                    <div class="headline-time">${article.date || article.publishDate}</div>
                `;
                headline.onclick = () => openModal(article.id);
                headlinesList.appendChild(headline);
            });
        }
    
        function filterByCategory(category) {
            currentFilter = category;
            
            document.querySelectorAll('.category-link, .mobile-menu-link').forEach(link => {
                link.classList.remove('active');
            });
            
            document.querySelectorAll('.category-link, .mobile-menu-link').forEach(link => {
                if (link.textContent.toLowerCase() === categoriesData.find(c => c.id === category)?.name.toLowerCase()) {
                    link.classList.add('active');
                }
            });
            
            renderCarousel();
            renderArticles(category);
        }
    
        function closeModal() {
            const modal = document.getElementById('articleModal');
            modal.classList.remove('active');
        }
    
        function toggleMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            menu.classList.toggle('active');
        }
    
        function extractYouTubeId(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }
    
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    
        async function submitJobApplication(articleId, jobUrl, jobTitle) {
            if (!makeWebhook || !authToken) {
                alert('Job application system not configured.');
                return;
            }
            
            const confirmed = confirm(`Submit job application for: ${jobTitle}?`);
            if (!confirmed) return;
            
            try {
                const response = await fetch(makeWebhook, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        articleId: articleId,
                        jobUrl: jobUrl,
                        jobTitle: jobTitle,
                        timestamp: new Date().toISOString()
                    })
                });
                
                if (response.ok) {
                    alert('✅ Job application submitted successfully!');
                } else {
                    throw new Error('Failed to submit');
                }
            } catch (error) {
                console.error('Error submitting job application:', error);
                alert('❌ Failed to submit job application. Please try again.');
            }
        }
    
        function shareArticle(platform, title, url) {
            const encodedTitle = encodeURIComponent(title);
            const encodedUrl = encodeURIComponent(url);
            
            let shareUrl = '';
            
            if (platform === 'twitter') {
                shareUrl = `https://twitter.com/intent/tweet?text=${encodedTitle}&url=${encodedUrl}`;
            } else if (platform === 'linkedin') {
                shareUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${encodedUrl}`;
            }
            
            if (shareUrl) {
                window.open(shareUrl, '_blank', 'width=600,height=400');
            }
        }
    
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('✅ Link copied to clipboard!');
            }).catch(() => {
                alert('❌ Failed to copy link');
            });
        }
    
        (function () {
          const btn = document.getElementById('reloadDataBtn');
          if (!btn) return;
        
          // Small helper to set temporary busy state
          function setWorking(isWorking) {
            if (isWorking) {
              btn.disabled = true;
              btn.dataset.origText = btn.textContent;
              btn.textContent = 'Reloading...';
              btn.style.opacity = '0.8';
            } else {
              btn.disabled = false;
              btn.textContent = btn.dataset.origText || '⟳ Reload';
              btn.style.opacity = '';
            }
          }
        
          async function reloadNewsData() {
            setWorking(true);
            try {
              // First, reload the styles configuration
              await loadAvailableStyles();
              
              // Then fetch fresh news data with no-cache to ensure latest copy is retrieved
              const resp = await fetch('./news-data.json', { cache: 'no-store' });
              if (!resp.ok) throw new Error('Failed to fetch news-data.json: ' + resp.status);
        
              const json = await resp.json();
        
              // Update global data
              categoriesData = json.categories || [];
              articlesData = json.articles || [];
              trendingData = json.trending || [];
              videosData = json.videos || [];
              makeWebhook = json.makeWebhook || '';
              authToken = json.authToken || '';
              
              // Re-render all components
              renderCategories();
              renderCarousel();
              renderArticles(currentFilter);
              renderHeadlines();
              
              // Show success message
              console.log('✅ Data and styles reloaded successfully!');
              
            } catch (err) {
              console.error(err);
              alert('Error reloading data: ' + (err.message || err));
            } finally {
              setWorking(false);
            }
          }
        
          btn.addEventListener('click', reloadNewsData);
        })();
    </script>
</body>
</html>
