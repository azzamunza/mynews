<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News Portal</title>
    <link rel="stylesheet" href="./css/article-magazine.css">
    <link rel="stylesheet" href="./css/layout-grid.css">
    <link id="themeStylesheet" rel="stylesheet" href="./css/newsStyles/cnn.css">
</head>
<body>
<header id="mainHeader">
    <div class="header-container">
        <div class="hamburger" id="hamburgerMenu"><span></span><span></span><span></span></div>
        <h1 class="site-title">NewsHub</h1>

        <!-- Header controls with style selector inline -->
        <div class="header-login">
            <!-- Style Selector moved inline -->
            <div class="header-inline-controls">
                <label for="styleSelector" class="style-selector-label">Theme:</label>
                <select id="styleSelector" class="style-selector">
                    <option value="">Loading styles...</option>
                </select>
            </div>
            
            <div id="user-info" class="header-user-info"></div>

            <button id="reloadDataBtn" class="btn btn-secondary" title="Reload news data" style="display:inline-flex; align-items:center;">
                ‚ü≥ Reload
            </button>
            
            <button id="bionicReaderBtn" class="btn btn-secondary" title="Toggle Bionic Reader" style="display:inline-flex; align-items:center;">
                üìñ Bionic Reader
            </button>
            
            <a href="config.html" class="btn btn-secondary" title="Configuration" style="display:inline-flex; align-items:center; text-decoration: none;">
                ‚öôÔ∏è Config
            </a>
            
            <div id="g_id_onload"
                 data-client_id="752307788655-djf0dae2j8h10q040g1ombshla687l0j.apps.googleusercontent.com"
                 data-login_uri="https://azzamunza.github.io/mynews/oauth2callback.html"
                 data-auto_prompt="false"
                 data-callback="handleCredentialResponse">
            </div>
            <div class="g_id_signin" data-type="standard"></div>
        </div>
    </div>

    <!-- Desktop Navigation (stays sticky) -->
    <nav id="desktopNav">
        <div class="nav-container">
            <ul class="category-menu" id="categoryMenu">
                <li class="loading">Loading categories...</li>
            </ul>
        </div>
    </nav>
</header>

    <!-- Mobile Menu -->
    <div class="mobile-menu-overlay" id="mobileMenu">
        <div class="mobile-menu-header">
            <h2 style="color: var(--accent-color);">Menu</h2>
            <span class="mobile-menu-close" id="closeMobileMenu">&times;</span>
        </div>
        <ul class="mobile-menu-items" id="mobileMenuItems">
            <li class="loading">Loading...</li>
        </ul>
    </div>

    <div class="main-layout">
        <div class="content-area">
            <!-- Hero Section - Two Columns: Left (Vertical Cards) | Right (Carousel) -->
            <section class="hero-section" id="heroSection" style="display: none;">
                <!-- Left Column: Vertical Article Cards (ONLY 2 CARDS) -->
                <div class="hero-left-articles" id="heroLeftArticles">
                    <!-- Will be populated with EXACTLY 2 article cards -->
                </div>
                
                <!-- Right Column: Carousel -->
                <div class="hero-right-carousel">
                    <div class="carousel-container">
                        <div class="carousel-slides" id="carouselSlides"></div>
                        <div class="carousel-nav">
                            <button class="carousel-btn" id="carouselPrev">‚Äπ</button>
                            <button class="carousel-btn" id="carouselNext">‚Ä∫</button>
                        </div>
                        <div class="carousel-dots" id="carouselDots"></div>
                    </div>
                </div>
            </section>

            <!-- NEW: Row of 4 Article Cards Below Hero -->
            <section class="article-cards-row" id="articleCardsRow" style="display: none;">
                <!-- Will be populated with 4 article cards -->
            </section>

            <!-- NEW REQUIREMENT #5 & #6: Tab Filtered View (shown when tab is clicked) -->
            <div class="tab-filtered-view" id="tabFilteredView" style="display: none;">
                <h2 class="tab-filtered-title" id="tabFilteredTitle"></h2>
                <div class="tab-filtered-content">
                    <div class="tab-filtered-left" id="tabFilteredLeft"></div>
                    <div class="tab-filtered-right" id="tabFilteredRight"></div>
                </div>
            </div>

            <!-- First Grid Row: AI Tech | Featured | Game News -->
            <div class="grid-row-first" id="gridRowFirst">
                <!-- AI Technology Column -->
                <div class="column-section ai-tech-section">
                    <h2 class="column-title">AI TECHNOLOGY</h2>
                    <div id="aiTechContent"></div>
                </div>

                <!-- Featured Article Column (30% wider) -->
                <div class="column-section featured-article-section">
                    <div id="featuredContent"></div>
                </div>

                <!-- Game News Column -->
                <div class="column-section game-news-section">
                    <h2 class="column-title">GAME NEWS</h2>
                    <div id="gameNewsContent"></div>
                </div>
            </div>

            <!-- Second Grid Row: Anime Section -->
            <div class="grid-row-anime" id="gridRowAnime">
                <h2 class="grid-row-anime-title">ANIME</h2>
                <div class="grid-anime-content">
                    <div class="anime-section-left" id="animeLeftContent"></div>
                    <div class="anime-section-right" id="animeRightContent"></div>
                </div>
            </div>

            <!-- Regular Article Grid -->
            <div class="article-grid" id="articleGrid">
                <div class="loading">
                    <div class="spinner"></div>
                    Loading articles...
                </div>
            </div>
        </div>

        <!-- Headlines Sidebar (NOW SCROLLS WITH BODY - Requirement #4) -->
        <aside class="headlines-sidebar">
            <h2 class="headlines-title">Headlines</h2>
            <div id="headlinesList">
                <div class="loading">Loading...</div>
            </div>
        </aside>
    </div>

    <!-- Full Width Section After Sidebar -->
    <div class="full-width-section" id="fullWidthSection" style="display: none;">
        <!-- Additional content can go here -->
    </div>

    <!-- Article Modal -->
    <div class="modal" id="articleModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">&times;</button>
            <div id="modalContentArea"></div>
        </div>
    </div>

   <script>
    let isLoggedIn = false;
    let loggedInUserEmail = '';
    let articlesData = [], categoriesData = [], trendingData = [], videosData = [];
    let currentFilter = 'all', currentCarouselIndex = 0;
    let carouselInterval, makeWebhook = '', authToken = '';
    let lastScrollTop = 0;
    let bionicReaderEnabled = false;
    let bionicConfig = {};
    
    document.addEventListener('DOMContentLoaded', function() {
        loadAvailableStyles();
        loadNewsData();
        setupEventListeners();
        setupScrollBehavior();
        loadBionicConfig();
        
        // Handle browser back/forward buttons
        window.addEventListener('popstate', function(event) {
            if (event.state && event.state.articleId) {
                openModal(event.state.articleId);
            } else {
                closeModal();
            }
        });
    });

    // Header scroll behavior
    function setupScrollBehavior() {
        let headerContainer = document.querySelector('.header-container');
        let desktopNav = document.getElementById('desktopNav');
        let scrollThreshold = 50;

        window.addEventListener('scroll', function() {
            let scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            
            if (scrollTop > scrollThreshold) {
                // Hide header-container but keep nav sticky
                headerContainer.style.transform = 'translateY(-100%)';
                // Ensure nav stays at top
                desktopNav.style.position = 'fixed';
                desktopNav.style.top = '0';
                desktopNav.style.left = '0';
                desktopNav.style.right = '0';
                desktopNav.style.width = '100%';
            } else {
                // Show header-container
                headerContainer.style.transform = 'translateY(0)';
                // Nav back to sticky
                desktopNav.style.position = 'sticky';
                desktopNav.style.left = '';
                desktopNav.style.right = '';
                desktopNav.style.width = '';
            }
            
            lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
        }, false);
    }
    
    // Load available styles dynamically from JSON
    async function loadAvailableStyles() {
        const styleSelector = document.getElementById('styleSelector');
        const stylesPath = './css/newsStyles/';
        const stylesJsonPath = './css/styles.json';
        
        try {
            const response = await fetch(stylesJsonPath);
            
            if (!response.ok) {
                throw new Error(`Failed to load styles.json: ${response.status}`);
            }
            
            const stylesConfig = await response.json();
            
            styleSelector.innerHTML = '';
            
            stylesConfig.styles.forEach(style => {
                const option = document.createElement('option');
                option.value = stylesPath + style.file;
                option.textContent = style.name;
                option.setAttribute('data-description', style.description);
                styleSelector.appendChild(option);
            });
            
            const savedStyle = localStorage.getItem('selectedStyle') || stylesPath + stylesConfig.default;
            styleSelector.value = savedStyle;
            loadStyle(savedStyle);
            
            styleSelector.addEventListener('change', function() {
                const selectedStyle = this.value;
                loadStyle(selectedStyle);
                localStorage.setItem('selectedStyle', selectedStyle);
            });
            
        } catch (error) {
            console.error('Error loading styles configuration:', error);
            styleSelector.innerHTML = '<option value="./css/newsStyles/darkstyle.css">Dark Style</option>';
            const fallbackStyle = './css/newsStyles/darkstyle.css';
            styleSelector.value = fallbackStyle;
            loadStyle(fallbackStyle);
        }
    }

    function loadStyle(styleUrl) {
        const themeLink = document.getElementById('themeStylesheet');
        themeLink.href = styleUrl;
    }

    function handleCredentialResponse(response) {
        const user = jwt_decode(response.credential);
        const userInfoDiv = document.getElementById('user-info');
        userInfoDiv.textContent = user.name;

        isLoggedIn = true;
        loggedInUserEmail = user.email;

        if (user.email === 'azzamunza@gmail.com') {
            const jobButtons = document.querySelectorAll('.btn-job');
            jobButtons.forEach(btn => btn.style.display = 'inline-block');
        }
    }

    async function openModal(articleId) {
        const article = articlesData.find(a => a.id === articleId);
        if (!article) return;

        const modal = document.getElementById('articleModal');
        const modalContent = document.getElementById('modalContentArea');
        
        // Add history state for back button navigation
        history.pushState({ articleId: articleId }, '', `#article-${articleId}`);
        
        // If article has a filename, load it inline instead of opening in new tab
        if (article.filename) {
            try {
                const response = await fetch(`./articles/${article.filename}`);
                if (response.ok) {
                    const html = await response.text();
                    // Extract the article content from the fetched HTML
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = html;
                    const articleContainer = tempDiv.querySelector('.article-container') || tempDiv.querySelector('.article-content');
                    if (articleContainer) {
                        modalContent.innerHTML = articleContainer.innerHTML;
                    } else {
                        modalContent.innerHTML = html;
                    }
                    modal.classList.add('active');
                    return;
                }
            } catch (error) {
                console.error('Error loading article:', error);
            }
        }

        let badges = '';
        if (article.isTrending) badges += '<span class="badge badge-trending">üî• Trending</span>';
        if (article.isJob) badges += '<span class="badge badge-job">üíº Job Listing</span>';
        if (article.isVideo) badges += '<span class="badge badge-video">‚ñ∂ Video Content</span>';

        let videoEmbed = '';
        if (article.isVideo && article.videoUrl) {
            const videoId = extractYouTubeId(article.videoUrl);
            if (videoId) {
                videoEmbed = `<div class="video-player-container">
                    <iframe src="https://www.youtube.com/embed/${videoId}?rel=0" allowfullscreen
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture">
                    </iframe>
                </div>`;
            }
        }

        let jobButton = '';
        if (article.isJob && makeWebhook && authToken && isLoggedIn && loggedInUserEmail === 'azzamunza@gmail.com') {
            jobButton = `<button class="btn btn-job" onclick="submitJobApplication(
                '${article.id}',
                '${escapeHtml(article.sourceUrl)}',
                '${escapeHtml(article.title)}'
            )">üíº Create Job Application</button>`;
        }

        const shareButtons = `
            <button class="btn btn-secondary" onclick="shareArticle('twitter','${escapeHtml(article.title)}','${escapeHtml(article.sourceUrl)}')">Share on Twitter</button>
            <button class="btn btn-secondary" onclick="shareArticle('linkedin','${escapeHtml(article.title)}','${escapeHtml(article.sourceUrl)}')">Share on LinkedIn</button>
            <button class="btn btn-secondary" onclick="copyToClipboard('${escapeHtml(article.sourceUrl)}')">üìã Copy Link</button>
        `;

        modalContent.innerHTML = `
            <img src="${article.bannerImage}" alt="${article.title}" class="modal-banner" loading="lazy">
            <div class="modal-body">
                <div class="modal-header-section">
                    <div class="modal-badges">${badges}</div>
                    <h1 class="modal-title">${article.title}</h1>
                    <div class="modal-meta">
                        <span>By ${article.author}</span>
                        <span>${article.publishDate}</span>
                        <span>${article.readTime} min read</span>
                    </div>
                    <div class="modal-actions">
                        <a href="${article.sourceUrl}" target="_blank" rel="noopener noreferrer" class="btn btn-primary">üì∞ Read Original Source</a>
                        ${jobButton}
                        ${shareButtons}
                    </div>
                </div>
                ${videoEmbed}
                <div class="modal-article-content">
                    ${article.fullContent}
                </div>
            </div>
        `;

        modal.classList.add('active');
    }

    function setupEventListeners() {
        document.getElementById('hamburgerMenu').addEventListener('click', toggleMobileMenu);
        document.getElementById('closeMobileMenu').addEventListener('click', toggleMobileMenu);
        document.getElementById('carouselPrev').addEventListener('click', () => changeSlide(-1));
        document.getElementById('carouselNext').addEventListener('click', () => changeSlide(1));
        
        document.getElementById('articleModal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });
        
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeModal();
        });
        
        // Setup horizontal scrolling for menu
        setupMenuScrolling();
    }
    
    function setupMenuScrolling() {
        const navContainer = document.querySelector('#desktopNav .nav-container');
        const categoryMenu = document.getElementById('categoryMenu');
        
        if (!navContainer || !categoryMenu) return;
        
        // Middle mouse button scrolling
        navContainer.addEventListener('wheel', function(e) {
            if (e.deltaY !== 0) {
                e.preventDefault();
                categoryMenu.scrollLeft += e.deltaY;
            }
        }, { passive: false });
        
        // Click and drag scrolling
        let isDown = false;
        let startX;
        let scrollLeft;
        
        categoryMenu.addEventListener('mousedown', function(e) {
            isDown = true;
            categoryMenu.style.cursor = 'grabbing';
            categoryMenu.style.userSelect = 'none';
            startX = e.pageX - categoryMenu.offsetLeft;
            scrollLeft = categoryMenu.scrollLeft;
        });
        
        categoryMenu.addEventListener('mouseleave', function() {
            isDown = false;
            categoryMenu.style.cursor = 'grab';
        });
        
        categoryMenu.addEventListener('mouseup', function() {
            isDown = false;
            categoryMenu.style.cursor = 'grab';
        });
        
        categoryMenu.addEventListener('mousemove', function(e) {
            if (!isDown) return;
            e.preventDefault();
            const x = e.pageX - categoryMenu.offsetLeft;
            const walk = (x - startX) * 2; // Scroll speed
            categoryMenu.scrollLeft = scrollLeft - walk;
        });
    }

    async function loadNewsData() {
        try {
            const response = await fetch('news-data.json');
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const data = await response.json();
            
            categoriesData = data.categories || [];
            articlesData = data.articles || [];
            trendingData = data.trending || [];
            videosData = data.videos || [];
            makeWebhook = data.makeWebhook || '';
            authToken = data.authToken || '';
            
            // Try to load and merge articles from articles.json
            try {
                const articlesResponse = await fetch('articles.json');
                if (articlesResponse.ok) {
                    const articlesJsonData = await articlesResponse.json();
                    if (articlesJsonData.articles && Array.isArray(articlesJsonData.articles)) {
                        // Merge articles, preferring articles.json entries (they have filename property)
                        const articleMap = new Map();
                        
                        // Add articles from news-data.json
                        articlesData.forEach(article => articleMap.set(article.id, article));
                        
                        // Override/add articles from articles.json
                        articlesJsonData.articles.forEach(article => {
                            if (article.id) {
                                articleMap.set(article.id, { ...articleMap.get(article.id), ...article });
                            }
                        });
                        
                        articlesData = Array.from(articleMap.values());
                        console.log(`‚úì Merged ${articlesJsonData.articles.length} articles from articles.json`);
                    }
                }
            } catch (articlesError) {
                console.log('Note: articles.json not loaded or error:', articlesError.message);
            }
            
            // Sort articles by date (newest first)
            articlesData.sort((a, b) => {
                const dateA = new Date(a.publishDate || '1970-01-01');
                const dateB = new Date(b.publishDate || '1970-01-01');
                return dateB - dateA; // Descending order (newest first)
            });
            
            renderCategories();
            renderHeroSection();
            renderArticleCardsRow();
            renderSpecializedSections();
            renderArticles();
            renderHeadlines();
            
        } catch (error) {
            console.error('Error loading news data:', error);
            showError(error.message);
        }
    }

    function showError(message) {
        document.getElementById('categoryMenu').innerHTML = 
            `<li style="color: var(--accent-color);">Error loading data: ${message}</li>`;
        document.getElementById('articleGrid').innerHTML = 
            `<div class="loading" style="color: var(--accent-color);">
                <p>Error loading articles: ${message}</p>
                <p style="font-size: 0.9rem; margin-top: 1rem;">Make sure news-data.json is in the same directory as this HTML file.</p>
            </div>`;
    }

    function renderCategories() {
        const desktopMenu = document.getElementById('categoryMenu');
        const mobileMenu = document.getElementById('mobileMenuItems');
        
        desktopMenu.innerHTML = '';
        mobileMenu.innerHTML = '';
        
        categoriesData.forEach(category => {
            // Desktop menu
            const li = document.createElement('li');
            li.className = 'category-item';
            const link = document.createElement('a');
            link.className = 'category-link' + (category.active ? ' active' : '');
            link.textContent = category.name;
            link.onclick = (e) => {
                e.preventDefault();
                filterByCategory(category.id);
            };
            li.appendChild(link);
            desktopMenu.appendChild(li);
            
            // Mobile menu
            const mli = document.createElement('li');
            mli.className = 'mobile-menu-item';
            const mlink = document.createElement('a');
            mlink.className = 'mobile-menu-link' + (category.active ? ' active' : '');
            mlink.textContent = category.name;
            mlink.onclick = (e) => {
                e.preventDefault();
                filterByCategory(category.id);
                toggleMobileMenu();
            };
            mli.appendChild(mlink);
            mobileMenu.appendChild(mli);
        });
    }

    // NEW REQUIREMENT #1: Hero section with ONLY 2 articles in left column
    function renderHeroSection() {
        const trendingArticles = articlesData.filter(a => a.isTrending);
        
        if (trendingArticles.length === 0 || currentFilter !== 'all') {
            document.getElementById('heroSection').style.display = 'none';
            return;
        }
        
        document.getElementById('heroSection').style.display = 'grid';
        
        // Render left column - EXACTLY 2 vertical article cards (NEW REQUIREMENT #1)
        const heroLeftArticles = document.getElementById('heroLeftArticles');
        const leftArticles = articlesData.filter(a => !a.isTrending).slice(0, 2); // ONLY 2 ARTICLES
        
        heroLeftArticles.innerHTML = '';
        leftArticles.forEach(article => {
            const card = document.createElement('div');
            card.className = 'hero-small-card cursor-pointer';
            card.onclick = () => openModal(article.id);
            
            let videoByline = '';
            if (article.isVideo) {
                videoByline = `<div class="video-byline">
                    <span class="play-icon">‚ñ∂</span>
                    ${article.readTime ? `<span class="video-duration">${article.readTime} min</span>` : ''}
                </div>`;
            }
            
            card.innerHTML = `
                <img src="${article.thumbnailImage}" alt="${article.title}" loading="lazy">
                <div class="hero-small-card-content">
                    <span class="article-category">${article.category}</span>
                    <h3 class="article-title">${article.title}</h3>
                    ${videoByline}
                    <div class="article-meta">
                        <span>${article.author}</span>
                        <span>${article.publishDate}</span>
                    </div>
                </div>
            `;
            
            heroLeftArticles.appendChild(card);
        });
        
        // Render right column - Carousel (same as before)
        const slidesContainer = document.getElementById('carouselSlides');
        const dotsContainer = document.getElementById('carouselDots');
        
        slidesContainer.innerHTML = '';
        dotsContainer.innerHTML = '';
        
        trendingArticles.forEach((article, index) => {
            const slide = document.createElement('div');
            slide.className = 'carousel-slide' + (index === 0 ? ' active' : '');
            
            let videoByline = '';
            if (article.isVideo) {
                videoByline = `<div class="video-byline">
                    <span class="play-icon">‚ñ∂</span>
                    ${article.readTime ? `<span class="video-duration">${article.readTime} min</span>` : ''}
                </div>`;
            }
            
            slide.innerHTML = `
                <img src="${article.bannerImage}" alt="${article.title}" loading="lazy">
                <div class="carousel-content">
                    <h2 class="carousel-title">${article.title}</h2>
                    <p class="carousel-excerpt">${article.excerpt}</p>
                    ${videoByline}
                    <div class="carousel-meta">
                        <span>By ${article.author}</span>
                        <span>${article.publishDate}</span>
                        <span>${article.readTime} min read</span>
                    </div>
                </div>
            `;
            slide.onclick = () => openModal(article.id);
            slidesContainer.appendChild(slide);
            
            const dot = document.createElement('div');
            dot.className = 'carousel-dot' + (index === 0 ? ' active' : '');
            dot.onclick = () => goToSlide(index);
            dotsContainer.appendChild(dot);
        });
        
        if (trendingArticles.length > 1) {
            startCarousel();
        }
    }
    
    // NEW: Render 4 article cards below hero section
    function renderArticleCardsRow() {
        if (currentFilter !== 'all') {
            document.getElementById('articleCardsRow').style.display = 'none';
            return;
        }
        
        document.getElementById('articleCardsRow').style.display = 'grid';
        const cardsRow = document.getElementById('articleCardsRow');
        cardsRow.innerHTML = '';
        
        // Get the next 4 articles after trending and hero left articles
        const usedArticles = [
            ...articlesData.filter(a => a.isTrending).map(a => a.id),
            ...articlesData.filter(a => !a.isTrending).slice(0, 2).map(a => a.id)
        ];
        
        const cardsToShow = articlesData
            .filter(a => !usedArticles.includes(a.id))
            .slice(0, 4);
        
        cardsToShow.forEach(article => {
            const card = document.createElement('div');
            card.className = 'article-card-simple';
            card.onclick = () => openModal(article.id);
            
            card.innerHTML = `
                <img src="${article.thumbnailImage}" alt="${article.title}" loading="lazy">
                <div class="card-content">
                    <div class="card-category">${article.category}</div>
                    <h3 class="card-title">${article.title}</h3>
                    <p class="card-excerpt">${article.excerpt || ''}</p>
                    <div class="card-meta">
                        <span>${article.author}</span>
                        <span>${article.publishDate}</span>
                    </div>
                </div>
            `;
            
            cardsRow.appendChild(card);
        });
    }

    function changeSlide(direction) {
        const slides = document.querySelectorAll('.carousel-slide');
        const dots = document.querySelectorAll('.carousel-dot');
        
        slides[currentCarouselIndex].classList.remove('active');
        dots[currentCarouselIndex].classList.remove('active');
        
        currentCarouselIndex = (currentCarouselIndex + direction + slides.length) % slides.length;
        
        slides[currentCarouselIndex].classList.add('active');
        dots[currentCarouselIndex].classList.add('active');
        
        resetCarousel();
    }

    function goToSlide(index) {
        const slides = document.querySelectorAll('.carousel-slide');
        const dots = document.querySelectorAll('.carousel-dot');
        
        slides[currentCarouselIndex].classList.remove('active');
        dots[currentCarouselIndex].classList.remove('active');
        
        currentCarouselIndex = index;
        
        slides[currentCarouselIndex].classList.add('active');
        dots[currentCarouselIndex].classList.add('active');
        
        resetCarousel();
    }

    function startCarousel() {
        carouselInterval = setInterval(() => {
            changeSlide(1);
        }, 5000);
    }

    function resetCarousel() {
        clearInterval(carouselInterval);
        startCarousel();
    }
    
    function changeSlideshow(index) {
        const images = document.querySelectorAll('.slideshow-image');
        const dots = document.querySelectorAll('.slideshow-dot');
        
        images.forEach((img, i) => {
            img.classList.toggle('active', i === index);
        });
        
        dots.forEach((dot, i) => {
            dot.classList.toggle('active', i === index);
        });
    }
    
    // ADD THIS FUNCTION HERE - BEFORE renderSpecializedSections()
    // NEW REQUIREMENT #5: Check if there's space in GAME NEWS column and add OTHER NEWS or gradient
    function renderGameNewsWithFill() {
        const gameArticles = articlesData.filter(a => 
            a.category === 'entertainment' || 
            a.title.toLowerCase().includes('game') || 
            a.title.toLowerCase().includes('gaming')
        ).slice(0, 5);
        
        const gameContent = document.getElementById('gameNewsContent');
        
        if (gameArticles.length > 0) {
            let html = '';
            gameArticles.forEach(article => {
                html += `
                    <div class="game-article cursor-pointer" onclick="openModal('${article.id}')">
                        <img src="${article.thumbnailImage}" alt="${article.title}" loading="lazy">
                        <div class="article-content">
                            <h4 class="article-title">${article.title}</h4>
                        </div>
                    </div>
                `;
            });
            gameContent.innerHTML = html;
        }
        
        // NEW REQUIREMENT #5: Add OTHER NEWS section or retro gradient
        const gameNewsSection = document.querySelector('.game-news-section');
        
        // Get articles not yet included
        const usedIds = [
            ...articlesData.filter(a => a.isTrending).map(a => a.id),
            ...articlesData.filter(a => !a.isTrending).slice(0, 2).map(a => a.id),
            ...articlesData.filter(a => a.category === 'ai-technology-and-news').slice(0, 6).map(a => a.id),
            ...articlesData.filter(a => a.isTrending || a.images?.length > 1).slice(0, 5).map(a => a.id),
            ...gameArticles.map(a => a.id),
            ...articlesData.filter(a => a.category === 'anime').slice(0, 3).map(a => a.id)
        ];
        
        const otherArticles = articlesData.filter(a => !usedIds.includes(a.id)).slice(0, 3);
        
        // Remove existing OTHER NEWS or gradient
        const existingOtherNews = gameNewsSection.querySelector('.other-news-section');
        const existingGradient = gameNewsSection.querySelector('.retro-gradient-fill');
        if (existingOtherNews) existingOtherNews.remove();
        if (existingGradient) existingGradient.remove();
        
        if (otherArticles.length > 0) {
            // Add OTHER NEWS section
            const otherNewsDiv = document.createElement('div');
            otherNewsDiv.className = 'other-news-section';
            
            let otherHtml = '<h3 class="column-title">OTHER NEWS</h3>';
            otherArticles.forEach(article => {
                otherHtml += `
                    <div class="other-news-article cursor-pointer" onclick="openModal('${article.id}')">
                        <img src="${article.thumbnailImage}" alt="${article.title}" loading="lazy">
                        <div class="article-content">
                            <h4 class="article-title">${article.title}</h4>
                        </div>
                    </div>
                `;
            });
            
            otherNewsDiv.innerHTML = otherHtml;
            gameNewsSection.appendChild(otherNewsDiv);
        } else {
            // Add 80s retro raster gradient
            const gradientDiv = document.createElement('div');
            gradientDiv.className = 'retro-gradient-fill';
            gameNewsSection.appendChild(gradientDiv);
        }
    }
    
    // NOW renderSpecializedSections() can call it
    function renderSpecializedSections() {
        // AI Technology Section
        const aiArticles = articlesData.filter(a => a.category === 'ai-technology-and-news').slice(0, 6);
        const aiContent = document.getElementById('aiTechContent');
        
        if (aiArticles.length > 0) {
            const featured = aiArticles[0];
            const others = aiArticles.slice(1, 6);
            
            let html = `
                <div class="featured-article cursor-pointer" onclick="openModal('${featured.id}')">
                    <img src="${featured.thumbnailImage}" alt="${featured.title}" loading="lazy">
                    <h3 class="article-title">${featured.title}</h3>
                </div>
                <div class="divider"></div>
            `;
            
            others.forEach((article, index) => {
                html += `
                    <div class="title-only-article">
                        <h4 class="article-title cursor-pointer" onclick="openModal('${article.id}')">${article.title}</h4>
                    </div>
                    ${index < others.length - 1 ? '<div class="divider"></div>' : ''}
                `;
            });
            
            aiContent.innerHTML = html;
        }
    
        // Featured Article with Slideshow
        const featuredArticles = articlesData.filter(a => a.isTrending || a.images?.length > 1).slice(0, 5);
        const featuredContent = document.getElementById('featuredContent');
        
        if (featuredArticles.length > 0) {
            const mainFeatured = featuredArticles[0];
            const others = featuredArticles.slice(1);
            
            let slideshowHtml = '';
            if (mainFeatured.images && mainFeatured.images.length > 1) {
                slideshowHtml = '<div class="featured-slideshow">';
                mainFeatured.images.forEach((img, idx) => {
                    slideshowHtml += `<img src="${img}" class="slideshow-image${idx === 0 ? ' active' : ''}" alt="${mainFeatured.title}">`;
                });
                slideshowHtml += '<div class="slideshow-controls">';
                mainFeatured.images.forEach((_, idx) => {
                    slideshowHtml += `<span class="slideshow-dot${idx === 0 ? ' active' : ''}" onclick="changeSlideshow(${idx})"></span>`;
                });
                slideshowHtml += '</div></div>';
            } else {
                slideshowHtml = `<div class="featured-slideshow"><img src="${mainFeatured.bannerImage}" class="slideshow-image active" alt="${mainFeatured.title}"></div>`;
            }
            
            let html = `
                <div class="main-featured cursor-pointer" onclick="openModal('${mainFeatured.id}')">
                    ${slideshowHtml}
                    <h3 class="article-title">${mainFeatured.title}</h3>
                </div>
            `;
            
            others.forEach(article => {
                html += `
                    <div class="horizontal-card cursor-pointer" onclick="openModal('${article.id}')">
                        <img src="${article.thumbnailImage}" alt="${article.title}" loading="lazy">
                        <div class="card-content">
                            <h4 class="article-title">${article.title}</h4>
                        </div>
                    </div>
                `;
            });
            
            featuredContent.innerHTML = html;
        }
    
        // Game News Section with OTHER NEWS or gradient fill (NEW REQUIREMENT #5)
        renderGameNewsWithFill();
    
        // Anime Section
        const animeArticles = articlesData.filter(a => a.category === 'anime').slice(0, 3);
        const animeLeft = document.getElementById('animeLeftContent');
        const animeRight = document.getElementById('animeRightContent');
        
        if (animeArticles.length > 0) {
            const large = animeArticles[0];
            animeLeft.innerHTML = `
                <div class="anime-large cursor-pointer" onclick="openModal('${large.id}')">
                    <img src="${large.bannerImage}" alt="${large.title}" loading="lazy">
                    <div class="overlay-title">${large.title}</div>
                </div>
            `;
            
            const small = animeArticles.slice(1, 3);
            let smallHtml = '';
            small.forEach(article => {
                smallHtml += `
                    <div class="anime-small cursor-pointer" onclick="openModal('${article.id}')">
                        <img src="${article.thumbnailImage}" alt="${article.title}" loading="lazy">
                        <h4 class="article-title">${article.title}</h4>
                    </div>
                `;
            });
            animeRight.innerHTML = smallHtml;
        }
    }

       

    function renderArticles(filterCategory = 'all') {
        const gridContainer = document.getElementById('articleGrid');
        gridContainer.innerHTML = '';
        
        // Get articles excluding those already shown in specialized sections
        const specializedIds = [
            ...articlesData.filter(a => a.isTrending).map(a => a.id),
            ...articlesData.filter(a => !a.isTrending).slice(0, 2).map(a => a.id), // Changed from 3 to 2
            ...articlesData.filter(a => a.category === 'ai-technology-and-news').slice(0, 6).map(a => a.id),
            ...articlesData.filter(a => a.category === 'entertainment').slice(0, 5).map(a => a.id),
            ...articlesData.filter(a => a.category === 'anime').slice(0, 3).map(a => a.id)
        ];
        
        const filteredArticles = (filterCategory === 'all' 
            ? articlesData 
            : articlesData.filter(article => article.category === filterCategory)
        ).filter(a => !specializedIds.includes(a.id));
        
        if (filteredArticles.length === 0) {
            gridContainer.innerHTML = '<div class="loading">No additional articles found.</div>';
            return;
        }
        
        filteredArticles.forEach(article => {
            const card = document.createElement('div');
            card.className = 'article-card';
            card.setAttribute('data-category', article.category);
            let badges = '';
            if (article.isTrending) badges += '<span class="badge badge-trending">üî• Trending</span>';
            if (article.isJob) badges += '<span class="badge badge-job">üíº Job</span>';
            if (article.isVideo) badges += '<span class="badge badge-video">‚ñ∂ Video</span>';
            
            let videoByline = '';
            if (article.isVideo) {
                videoByline = `<div class="video-byline">
                    <span class="play-icon">‚ñ∂</span>
                    ${article.readTime ? `<span class="video-duration">${article.readTime} min</span>` : ''}
                </div>`;
            }
            
            const imageHtml = article.isVideo 
                ? `<div class="video-thumbnail">
                     <img src="${article.thumbnailImage}" alt="${article.title}" class="article-image" loading="lazy">
                     <div class="video-play-icon">‚ñ∂</div>
                   </div>`
                : `<img src="${article.thumbnailImage}" alt="${article.title}" class="article-image" loading="lazy">`;
            
            card.innerHTML = `
                <div class="article-image-container">
                    ${imageHtml}
                    <div class="article-badges">${badges}</div>
                </div>
                <div class="article-content">
                    <span class="article-category">${article.category}</span>
                    <h2 class="article-title">${article.title}</h2>
                    <p class="article-excerpt">${article.excerpt}</p>
                    ${videoByline}
                    <div class="article-meta">
                        <span>${article.author}</span>
                        <span>${article.publishDate}</span>
                    </div>
                </div>
            `;
            
            card.onclick = () => openModal(article.id);
            gridContainer.appendChild(card);
        });
    }

    function renderHeadlines() {
        const headlinesList = document.getElementById('headlinesList');
        headlinesList.innerHTML = '';
        
        const recentArticles = articlesData.slice(0, 10);
        
        recentArticles.forEach(article => {
            const headline = document.createElement('div');
            headline.className = 'headline-item';
            headline.innerHTML = `
                <div class="headline-category">${article.category}</div>
                <div class="headline-title">${article.title}</div>
                <div class="headline-time">${article.publishDate}</div>
            `;
            headline.onclick = () => openModal(article.id);
            headlinesList.appendChild(headline);
        });
    }

    // NEW REQUIREMENT #5 & #6: Filter by category showing ANIME-style layout
    function filterByCategory(category) {
        currentFilter = category;
        
        // Close modal if open (NEW REQUIREMENT #6)
        closeModal();
        
        // Update active state on menu items
        document.querySelectorAll('.category-link, .mobile-menu-link').forEach(link => {
            link.classList.remove('active');
        });
        
        document.querySelectorAll('.category-link, .mobile-menu-link').forEach(link => {
            if (link.textContent.toLowerCase() === categoriesData.find(c => c.id === category)?.name.toLowerCase()) {
                link.classList.add('active');
            }
        });
        
        // NEW REQUIREMENT #5: When clicking a tab (not 'all'), show ONLY filtered articles in ANIME layout
        if (category === 'all') {
            // Show regular homepage layout
            document.getElementById('heroSection').style.display = 'grid';
            document.getElementById('articleCardsRow').style.display = 'grid';
            document.getElementById('gridRowFirst').style.display = 'grid';
            document.getElementById('gridRowAnime').style.display = 'block';
            document.getElementById('articleGrid').style.display = 'grid';
            document.getElementById('tabFilteredView').style.display = 'none';
            
            renderHeroSection();
            renderArticleCardsRow();
            renderSpecializedSections();
            renderArticles();
        } else {
            // Hide all default sections and show ONLY the filtered tab view
            document.getElementById('heroSection').style.display = 'none';
            document.getElementById('articleCardsRow').style.display = 'none';
            document.getElementById('gridRowFirst').style.display = 'none';
            document.getElementById('gridRowAnime').style.display = 'none';
            document.getElementById('articleGrid').style.display = 'none';
            document.getElementById('tabFilteredView').style.display = 'block';
            
            // Render filtered articles in ANIME-style layout
            renderTabFilteredView(category);
        }
    }

    // NEW REQUIREMENT #5: Render tab-filtered articles in ANIME section layout
    function renderTabFilteredView(category) {
        const categoryName = categoriesData.find(c => c.id === category)?.name || category.toUpperCase();
        const filteredArticles = articlesData.filter(a => a.category === category);
        
        document.getElementById('tabFilteredTitle').textContent = categoryName;
        
        const leftContainer = document.getElementById('tabFilteredLeft');
        const rightContainer = document.getElementById('tabFilteredRight');
        
        if (filteredArticles.length === 0) {
            leftContainer.innerHTML = '<div class="loading">No articles found in this category.</div>';
            rightContainer.innerHTML = '';
            return;
        }
        
        // Large article on left (60%)
        const largeArticle = filteredArticles[0];
        leftContainer.innerHTML = `
            <div class="tab-filtered-large cursor-pointer" onclick="openModal('${largeArticle.id}')">
                <img src="${largeArticle.bannerImage}" alt="${largeArticle.title}" loading="lazy">
                <div class="overlay-title">${largeArticle.title}</div>
            </div>
        `;
        
        // Small articles on right (40%)
        const smallArticles = filteredArticles.slice(1, 3);
        let smallHtml = '';
        
        if (smallArticles.length > 0) {
            smallArticles.forEach(article => {
                smallHtml += `
                    <div class="tab-filtered-small cursor-pointer" onclick="openModal('${article.id}')">
                        <img src="${article.thumbnailImage}" alt="${article.title}" loading="lazy">
                        <h4 class="article-title">${article.title}</h4>
                    </div>
                `;
            });
        } else {
            smallHtml = '<div class="loading">Only one article available in this category.</div>';
        }
        
        rightContainer.innerHTML = smallHtml;
        
        // If there are more articles, show them below in a grid
        const remainingArticles = filteredArticles.slice(3);
        if (remainingArticles.length > 0) {
            const gridContainer = document.getElementById('articleGrid');
            gridContainer.style.display = 'grid';
            gridContainer.innerHTML = '';
            
            remainingArticles.forEach(article => {
                const card = document.createElement('div');
                card.className = 'article-card';
                
                let badges = '';
                if (article.isTrending) badges += '<span class="badge badge-trending">üî• Trending</span>';
                if (article.isJob) badges += '<span class="badge badge-job">üíº Job</span>';
                if (article.isVideo) badges += '<span class="badge badge-video">‚ñ∂ Video</span>';
                
                let videoByline = '';
                if (article.isVideo) {
                    videoByline = `<div class="video-byline">
                        <span class="play-icon">‚ñ∂</span>
                        ${article.readTime ? `<span class="video-duration">${article.readTime} min</span>` : ''}
                    </div>`;
                }
                
                const imageHtml = article.isVideo 
                    ? `<div class="video-thumbnail">
                         <img src="${article.thumbnailImage}" alt="${article.title}" class="article-image" loading="lazy">
                         <div class="video-play-icon">‚ñ∂</div>
                       </div>`
                    : `<img src="${article.thumbnailImage}" alt="${article.title}" class="article-image" loading="lazy">`;
                
                card.innerHTML = `
                    <div class="article-image-container">
                        ${imageHtml}
                        <div class="article-badges">${badges}</div>
                    </div>
                    <div class="article-content">
                        <span class="article-category">${article.category}</span>
                        <h2 class="article-title">${article.title}</h2>
                        <p class="article-excerpt">${article.excerpt}</p>
                        ${videoByline}
                        <div class="article-meta">
                            <span>${article.author}</span>
                            <span>${article.publishDate}</span>
                        </div>
                    </div>
                `;
                
                card.onclick = () => openModal(article.id);
                gridContainer.appendChild(card);
            });
        }
    }

    function closeModal() {
        const modal = document.getElementById('articleModal');
        modal.classList.remove('active');
        // Update URL to remove hash if present
        if (window.location.hash) {
            history.pushState('', document.title, window.location.pathname);
        }
    }

    function toggleMobileMenu() {
        const menu = document.getElementById('mobileMenu');
        menu.classList.toggle('active');
    }

    function extractYouTubeId(url) {
        const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
        const match = url.match(regExp);
        return (match && match[2].length === 11) ? match[2] : null;
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    async function submitJobApplication(articleId, jobUrl, jobTitle) {
        if (!makeWebhook || !authToken) {
            alert('Job application system not configured.');
            return;
        }
        
        const confirmed = confirm(`Submit job application for: ${jobTitle}?`);
        if (!confirmed) return;
        
        try {
            const response = await fetch(makeWebhook, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`
                },
                body: JSON.stringify({
                    articleId: articleId,
                    jobUrl: jobUrl,
                    jobTitle: jobTitle,
                    timestamp: new Date().toISOString()
                })
            });
            
            if (response.ok) {
                alert('‚úÖ Job application submitted successfully!');
            } else {
                throw new Error('Failed to submit');
            }
        } catch (error) {
            console.error('Error submitting job application:', error);
            alert('‚ùå Failed to submit job application. Please try again.');
        }
    }

    function shareArticle(platform, title, url) {
        const encodedTitle = encodeURIComponent(title);
        const encodedUrl = encodeURIComponent(url);
        
        let shareUrl = '';
        
        if (platform === 'twitter') {
            shareUrl = `https://twitter.com/intent/tweet?text=${encodedTitle}&url=${encodedUrl}`;
        } else if (platform === 'linkedin') {
            shareUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${encodedUrl}`;
        }
        
        if (shareUrl) {
            window.open(shareUrl, '_blank', 'width=600,height=400');
        }
    }

    function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(() => {
            alert('‚úÖ Link copied to clipboard!');
        }).catch(() => {
            alert('‚ùå Failed to copy link');
        });
    }

    // Reload data functionality
    (function () {
      const btn = document.getElementById('reloadDataBtn');
      if (!btn) return;
    
      function setWorking(isWorking) {
        if (isWorking) {
          btn.disabled = true;
          btn.dataset.origText = btn.textContent;
          btn.textContent = 'Reloading...';
          btn.style.opacity = '0.8';
        } else {
          btn.disabled = false;
          btn.textContent = btn.dataset.origText || '‚ü≥ Reload';
          btn.style.opacity = '';
        }
      }
    
      async function reloadNewsData() {
        setWorking(true);
        try {
          await loadAvailableStyles();
          
          const resp = await fetch('./news-data.json', { cache: 'no-store' });
          if (!resp.ok) throw new Error('Failed to fetch news-data.json: ' + resp.status);
    
          const json = await resp.json();
    
          categoriesData = json.categories || [];
          articlesData = json.articles || [];
          trendingData = json.trending || [];
          videosData = json.videos || [];
          makeWebhook = json.makeWebhook || '';
          authToken = json.authToken || '';
          
          // Reset to homepage view
          currentFilter = 'all';
          
          renderCategories();
          renderHeroSection();
          renderArticleCardsRow();
          renderSpecializedSections();
          renderArticles();
          renderHeadlines();
          
          // Hide tab filtered view
          document.getElementById('tabFilteredView').style.display = 'none';
          document.getElementById('articleCardsRow').style.display = 'grid';
          document.getElementById('heroSection').style.display = 'grid';
          document.getElementById('gridRowFirst').style.display = 'grid';
          document.getElementById('gridRowAnime').style.display = 'block';
          document.getElementById('articleGrid').style.display = 'grid';
          
          console.log('‚úÖ Data and styles reloaded successfully!');
          
        } catch (err) {
          console.error(err);
          alert('Error reloading data: ' + (err.message || err));
        } finally {
          setWorking(false);
        }
      }
    
      btn.addEventListener('click', reloadNewsData);
    })();
    
    // Bionic Reader functionality
    async function loadBionicConfig() {
        try {
            let config;
            
            // First check localStorage for pending config changes
            const localConfig = localStorage.getItem('mynews_config_pending');
            if (localConfig) {
                try {
                    config = JSON.parse(localConfig);
                    console.log('Using config from localStorage (pending GitHub update)');
                } catch (e) {
                    console.warn('Invalid local config, falling back to server');
                }
            }
            
            // If no local config, fetch from server
            if (!config) {
                const response = await fetch('config.json?t=' + Date.now());
                if (response.ok) {
                    config = await response.json();
                }
            }
            
            if (config) {
                bionicConfig = config.bionicReader || {
                    enabled: false,
                    fixationStrength: 50,
                    boldFont: 'inherit',
                    boldColor: '#000000',
                    boldWeight: '700',
                    regularFont: 'inherit',
                    regularColor: '#666666',
                    regularOpacity: 70,
                    fontSize: '1em',
                    lineHeight: '1.6'
                };
                
                bionicReaderEnabled = bionicConfig.enabled;
                
                // Setup button handler
                const bionicBtn = document.getElementById('bionicReaderBtn');
                if (bionicBtn) {
                    bionicBtn.addEventListener('click', toggleBionicReader);
                    updateBionicButtonState();
                }
                
                // Apply if enabled by default
                if (bionicReaderEnabled) {
                    applyBionicReader();
                }
            }
        } catch (error) {
            console.error('Error loading bionic config:', error);
        }
    }
    
    function toggleBionicReader() {
        bionicReaderEnabled = !bionicReaderEnabled;
        
        if (bionicReaderEnabled) {
            applyBionicReader();
        } else {
            removeBionicReader();
        }
        
        updateBionicButtonState();
    }
    
    function updateBionicButtonState() {
        const bionicBtn = document.getElementById('bionicReaderBtn');
        if (bionicBtn) {
            if (bionicReaderEnabled) {
                bionicBtn.style.background = 'var(--accent-color)';
                bionicBtn.style.color = 'white';
                bionicBtn.title = 'Disable Bionic Reader';
            } else {
                bionicBtn.style.background = '';
                bionicBtn.style.color = '';
                bionicBtn.title = 'Enable Bionic Reader';
            }
        }
    }
    
    function applyBionicReader() {
        // Apply to all text content in articles and cards
        const textElements = document.querySelectorAll('.article-title, .article-excerpt, .article-content, .modal-article-content, .carousel-title, .carousel-excerpt, p, h1, h2, h3, h4, h5, h6');
        
        textElements.forEach(element => {
            if (element.dataset.originalText) return; // Already processed
            
            const originalText = element.textContent;
            element.dataset.originalText = originalText;
            
            const bionicHTML = convertToBionic(originalText);
            element.innerHTML = bionicHTML;
        });
        
        // Apply custom styles
        applyBionicStyles();
    }
    
    function removeBionicReader() {
        const textElements = document.querySelectorAll('[data-original-text]');
        
        textElements.forEach(element => {
            const originalText = element.dataset.originalText;
            element.textContent = originalText;
            delete element.dataset.originalText;
        });
        
        // Remove custom styles
        const styleElement = document.getElementById('bionic-reader-styles');
        if (styleElement) {
            styleElement.remove();
        }
    }
    
    function convertToBionic(text) {
        // Split text into words
        const words = text.split(/(\s+)/); // Preserve whitespace
        
        return words.map(word => {
            // Skip whitespace and short words
            if (/^\s*$/.test(word) || word.length <= 1) {
                return word;
            }
            
            // Calculate how many characters to bold based on fixation strength
            const fixationStrength = bionicConfig.fixationStrength || 50;
            const boldLength = Math.max(1, Math.ceil(word.length * (fixationStrength / 100)));
            
            const boldPart = word.substring(0, boldLength);
            const regularPart = word.substring(boldLength);
            
            return `<span class="bionic-bold">${boldPart}</span><span class="bionic-regular">${regularPart}</span>`;
        }).join('');
    }
    
    function applyBionicStyles() {
        // Remove existing styles if any
        let styleElement = document.getElementById('bionic-reader-styles');
        if (!styleElement) {
            styleElement = document.createElement('style');
            styleElement.id = 'bionic-reader-styles';
            document.head.appendChild(styleElement);
        }
        
        const boldColor = bionicConfig.boldColor || '#000000';
        const boldFont = bionicConfig.boldFont || 'inherit';
        const boldWeight = bionicConfig.boldWeight || '700';
        const regularColor = bionicConfig.regularColor || '#666666';
        const regularFont = bionicConfig.regularFont || 'inherit';
        const regularOpacity = (bionicConfig.regularOpacity || 70) / 100;
        const fontSize = bionicConfig.fontSize || '1em';
        const lineHeight = bionicConfig.lineHeight || '1.6';
        
        styleElement.textContent = `
            .bionic-bold {
                color: ${boldColor};
                font-family: ${boldFont};
                font-weight: ${boldWeight};
            }
            
            .bionic-regular {
                color: ${regularColor};
                font-family: ${regularFont};
                opacity: ${regularOpacity};
            }
            
            [data-original-text] {
                font-size: ${fontSize} !important;
                line-height: ${lineHeight} !important;
            }
        `;
    }
    </script>
</body>
</html>
